# vim:set syntax=tcsh

echo -n "\033]2;tcsh: $cwd\007"

unset printexitvalue

# Only get the branch once, for the sake of efficiency
if ( $?reporoot ) then
	if ( "$cwd" =~ "$reporoot*" ) then
		# TODO: Git specific
		if ( $reporoot == `stat -c%Y "$reporoot"/.git/HEAD` ) then
			goto end
		endif
	endif
endif

hg branch >& /dev/null
if ( $? == 0 ) then
	set repo = `hg branch`
	set prompt = "[%~]($repo)%# "
	set reporoot = `hg root`
	goto end
endif

git rev-parse --abbrev-ref HEAD >& /dev/null
if ( $? == 0 ) then
	set repo = `git rev-parse --abbrev-ref HEAD`
	set prompt = "[%~]($repo)%# "
	set reporoot = `git rev-parse --show-toplevel`
	set repochanged = `stat -c%Y "$reporoot"/.git/HEAD`
	goto end
endif 

set prompt = "[%~]%# "
unset reporoot
unset repochanged


end:
	# TODO: Don't assume it was set
	set printexitvalue
